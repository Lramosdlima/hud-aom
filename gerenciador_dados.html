<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Interface de Jogo</title>
  <link rel="icon" href="AoM/assets/AoMR_Omniscience_icon.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    .gameInfo {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .info {
      width: 50%;
      background-color: #383838;
      padding: 15px;
      border-radius: 8px;
    }

    .resultado-partida {
      width: 50%;
      background-color: #383838;
      margin-bottom: 20px;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
      color: white;
    }

    #vencedor {
      margin-top: 15px;
      margin-bottom: 15px;
    }

    .section-title {
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      padding: 5px;
    }

    .versus {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .linha-labels,
    .linha-selects,
    .linha-botao,
    .salvlimp {
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    .linha-labels,
    .salvlimp,
    .linha-botao {
      margin-top: 20px;
    }

    .linha-labels label,
    .linha-selects select,
    .linha-botao button,
    .salvlimp button {
      width: 100%;
    }

    .linha-placar {
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 130%;
      gap: 30px;
    }

    .linha-placar span {
      font-weight: bold;
      width: 100%;
    }

    .linha-placar button {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .placar button {
      background-color: rgba(0, 0, 0, 0.5);
      font-weight: bold;
    }

    .placar button:hover {
      background-color: #000;
    }

    #placar1,
    #placar2 {
      font-weight: bold;
      font-size: 150%;
    }

    .resultados-partidas {
      display: flex;
      flex-direction: column;
      gap: 15px;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      font-weight: lighter;
      color: white;
      font-size: 20px;
    }

    .partida {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .deus-img {
      width: 55px;
      height: auto;
      object-fit: contain;
    }

    .mapa-img {
      width: 55px;
      height: auto;
      object-fit: contain;
    }

    .cinza {
      color: gray;
      filter: grayscale(90%);
    }

    .nome {
      margin-right: 2px;
    }

    .partida.esquerda {
      padding: 2px 16px;
      border-radius: 6px;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.7) 1%, transparent 100%);
    }

    .partida.direita {
      justify-content: flex-end;
      padding: 2px 16px;
      border-radius: 6px;
      background: linear-gradient(to left, rgba(0, 0, 0, 0.7) 1%, transparent 100%);
    }

    .versusSelect1 {
      border-radius: 5px;
      padding: 5px;
    }

    .versusSelect2 {
      border-radius: 5px;
      padding: 5px;
    }

    .jogadorv1:hover,
    .jogadorv2:hover {
      /* Adiciona uma transição para suavizar o efeito de hover */
      transition: filter 0.2s ease-in-out;
      /* Aumenta o brilho da cor de fundo em 30% (1.3) para simular o "semi-branco" */
      filter: brightness(1.3);
    }

    .versus .botoes {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
    }

    .scoreboard {
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .player1 {
      width: 48%;
      padding: 15px;
      border-radius: 8px;
      background-color: #1d1d4a;
    }

    .player2 {
      width: 48%;
      padding: 15px;
      border-radius: 8px;
      background-color: #541b1b;
    }

    .nome-pais {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    input[type="text"],
    select {
      padding: 5px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
    }

    .bandeira {
      height: 24px;
      width: auto;
    }

    .avatarUrl {
      height: 30px;
      width: auto;
      border-radius: 4px;
    }

    button {
      background-color: rgba(0, 0, 0, 0.5);
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 16px;
      border-radius: 5px;
    }

    button:hover {
      background-color: #666;
    }

    .picks-bans {
      margin-top: 10px;
    }

    .section-title {
      margin: 10px 0 5px;
      font-weight: bold;
    }

    .item-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 11px;
      margin-bottom: 10px;
    }

    .item-img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      cursor: pointer;
      border-radius: 2px;
      background-color: #000;
    }

    .loading-message {
      /* Centraliza o conteúdo (texto e spinner) */
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      color: #e5c159;
      /* Cor do texto de carregamento */
    }


    /* Estilo do Spinner (O círculo giratório) */
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      /* Cor clara de fundo */
      border-top: 4px solid #e5c159;
      /* Cor do elemento giratório (amarelo ouro) */
      border-radius: 50%;
      width: 100px;
      height: 100px;
      animation: spin 1s linear infinite;
      /* Aplica a animação */
      margin-bottom: 10px;
      /* Espaçamento entre o spinner e o texto */
    }

    /* Definição da Animação de Rotação */
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div class="gameInfo">
    <div class="info" style="margin-bottom: 20px;">
      <div class="section-title">Informações do Campeonato</div>

      <div style="margin-bottom: 10px; text-align: center;">
        <label for="logo_camp" style="display: block; text-align: left;">Logo do Campeonato*</label>
        <small style="display: block; text-align: left; color: #bbb; margin-bottom: 5px; font-style: italic;">
          Importante: O arquivo carregado ao clicar aqui é apenas o nome dele; a imagem deve estar na pasta <strong>/assets/campeonatos</strong>.
        </small>

        <input type="hidden" id="logo_camp" value="">

        <input type="file" id="inputLogoCamp" accept="image/png" onchange="processarLogoCamp(event)"
          style="display: none;">

        <button type="button" id="btnLogoCamp" onclick="document.getElementById('inputLogoCamp').click()"
          style="width: 100%; padding: 8px; cursor: pointer; background-color: #555; color: white; border: 1px solid #777; border-radius: 4px; margin-bottom: 10px;">
          Carregar Logo
        </button>

        <div id="previewContainer"
          style="display: none; justify-content: center; align-items: center; background: #222; padding: 10px; border-radius: 4px;">
          <img id="logoPreview" src="" alt="Preview" style="max-height: 50px; max-width: 100%; object-fit: contain;">
        </div>
      </div>

      <div style="margin-bottom: 10px; display: flex;  align-items: center; gap: 10px;">

        <div style="display: flex; flex-direction: column; flex-grow: 2">

          <div style="margin-top: 10px; ">
            <input id="draftLink" type="text" placeholder="Link do draft de gods" style=" width: 70%; padding: 5px;">
            <button onclick="importarDraftGods()" style="margin-top: 5px; margin-bottom: 8px;">Importar Gods</button>
          </div>

          <div style="margin-top: 10px;">
            <input id="draftLinkMapas" type="text" placeholder="Link do draft de mapas"
              style=" width: 70%; padding: 5px;">
            <button onclick="importarDraftMapas()" style="margin-top: 5px; margin-bottom: 8px;">Importar Mapas</button>
          </div>
        </div>

        <button style="height: 50%" onclick="captainsLink()" title="Captains Site">
          <img src="AoM/assets/captains-icon.png" alt="Captains Link">
        </button>


      </div>

      <div style="margin-bottom: 10px; display: flex; gap: 10px;">
        <div style="flex: 1;">
          <label for="cor1">Cor Esquerda</label><br>
          <select id="cor1" style="width: 100%; padding: 5px;" onchange="trocarCorDeFundo()">
            <option value="azul">Azul</option>
            <option value="vermelho">Vermelho</option>
            <option value="amarelo">Amarelo</option>
            <option value="verde">Verde</option>
            <option value="ciano">Ciano</option>
            <option value="rosa">Rosa</option>
            <option value="laranja">Laranja</option>
            <option value="vinho">Vinho</option>
            <option value="turquesa">Turquesa</option>
            <option value="salmao">Salmao</option>
            <option value="roxo">Roxo</option>
            <option value="cinza">Cinza</option>
          </select>
        </div>
        <div style="flex: 1;">
          <label for="cor2">Cor Direita</label><br>
          <select id="cor2" style="width: 100%; padding: 5px;" onchange="trocarCorDeFundo()">
            <option value="vermelho">Vermelho</option>
            <option value="azul">Azul</option>
            <option value="amarelo">Amarelo</option>
            <option value="verde">Verde</option>
            <option value="ciano">Ciano</option>
            <option value="rosa">Rosa</option>
            <option value="laranja">Laranja</option>
            <option value="vinho">Vinho</option>
            <option value="turquesa">Turquesa</option>
            <option value="salmao">Salmao</option>
            <option value="roxo">Roxo</option>
            <option value="cinza">Cinza</option>
          </select>
        </div>
      </div>


      <div style="margin-bottom: 10px;">
        <label for="letreiro">Posição dos Jogadores no Letreiro</label><br>
        <select id="letreiro" style="width: 100%; padding: 5px;">
          <option value="1">Player 1 | Player 2</option>
          <option value="2">Player 2 | Player 1</option>
        </select>
      </div>



      <div class="salvlimp">
        <button onclick="salvarDados()">Salvar Dados</button>
        <input type="file" id="arquivoDados" accept=".txt" onchange="processarArquivo(event)" style="display: none;">
        <button onclick="dispararInput()">Carregar Dados</button>
        <button onclick="limparDados()">Limpar Dados</button>
      </div>

    </div>

    <div class="resultado-partida">
      <h3 class="section-title">Informações da Partida</h3>
      <div style="margin-bottom: 10px;">
        <label for="mapaSelect">Mapa</label><br>
        <select id="mapaSelect" style="width: 100%; padding: 5px;">
          <option value="null" title="Selecione um Mapa">Selecione um Mapa</option>
          <option value="Random" title="Mapa aleatório">Random</option>
          <option value="Acropolis" title="Acropolis">Acropolis</option>
          <option value="Alfheim" title="Alfheim">Alfheim</option>
          <option value="Anatolia" title="Anatolia">Anatolia</option>
          <option value="Air" title="Air">Air</option>
          <option value="Arena" title="Arena">Arena</option>
          <option value="Aso Grasslands" title="Aso Grasslands">Aso Grasslands</option>
          <option value="Bamboo Grove" title="Bamboo Grove">Bamboo Grove</option>
          <option value="Archipelago" title="Archipelago">Archipelago</option>
          <option value="Blue Lagoon" title="Blue Lagoon">Blue Lagoon</option>
          <option value="Elysium" title="Elysium">Elysium</option>
          <option value="Erebus" title="Erebus">Erebus</option>
          <option value="Ghost Lake" title="Ghost Lake">Ghost Lake</option>
          <option value="Giza" title="Giza">Giza</option>
          <option value="Gold Rush" title="Gold Rush">Gold Rush</option>
          <option value="Highland" title="Highland">Highland</option>
          <option value="Iron Wood" title="Iron Wood">Iron Wood</option>
          <option value="Islands" title="Islands">Islands</option>
          <option value="Jotunheim" title="Jotunheim">Jotunheim</option>
          <option value="Kerlaugar" title="Kerlaugar">Kerlaugar</option>
          <option value="Kii" title="Kii">Kii</option>
          <option value="Land Nomad" title="Land Nomad">Land Nomad</option>
          <option value="Land Unknown" title="Land Unknown">Land Unknown</option>
          <option value="Marsh" title="Marsh">Marsh</option>
          <option value="Mediterranean" title="Mediterranean">Mediterranean</option>
          <option value="Megalopolis" title="Megalopolis">Megalopolis</option>
          <option value="Midgard" title="Midgard">Midgard</option>
          <option value="Mirage" title="Mirage">Mirage</option>
          <option value="Mirkwood" title="Mirkwood">Mirkwood</option>
          <option value="Mount Olympus" title="Mount Olympus">Mount Olympus</option>
          <option value="Muspellheim" title="Muspellheim">Muspellheim</option>
          <option value="Nile Shallows" title="Nile Shallows">Nile Shallows</option>
          <option value="Nomad" title="Nomad">Nomad</option>
          <option value="Oasis" title="Oasis">Oasis</option>
          <option value="Okuchichibu" title="Okuchichibu">Okuchichibu</option>
          <option value="Peach Blossom Land" title="Peach Blossom Land">Peach Blossom Land</option>
          <option value="River Nile" title="River Nile">River Nile</option>
          <option value="River Styx" title="River Styx">River Styx</option>
          <option value="Savannah" title="Savannah">Savannah</option>
          <option value="Sea of Worms" title="Sea of Worms">Sea of Worms</option>
          <option value="Senjogahara" title="Senjogahara">Senjogahara</option>
          <option value="Setonaikai" title="Setonaikai">Setonaikai</option>
          <option value="Silk Road" title="Silk Road">Silk Road</option>
          <option value="Snake Dance" title="Snake Dance">Snake Dance</option>
          <option value="Steppe" title="Steppe">Steppe</option>
          <option value="Team Migration" title="Team Migration">Team Migration</option>
          <option value="Tundra" title="Tundra">Tundra</option>
          <option value="Valley of Kings" title="Valley of Kings">Valley of Kings</option>
          <option value="Vindlandsaga" title="Vindlandsaga">Vindlandsaga</option>
          <option value="Watering Hole" title="Watering Hole">Watering Hole</option>
          <option value="Yellow River" title="Yellow River">Yellow River</option>

          <!-- TORNEIO DE VERAO MAPAS -->

          <option value="Buraco dAgua" title="Buraco dAgua">Buraco d'água</option>
          <option value="Elisio" title="Elisio">Elísio</option>
          <option value="Estepe" title="Estepe">Estepe</option>
          <option value="Gize" title="Gize">Gizé</option>
          <option value="Lagoa Azul" title="Lagoa Azul">Lagoa Azul</option>
          <option value="Lago Fantasma" title="Lago Fantasma">Lago Fantasma</option>
          <option value="Mediterraneo" title="Mediterraneo">Mediterrâneo</option>
          <option value="Megalopole" title="Megalopole">Megalópole</option>
          <option value="Pantano" title="Pantano">Pântano</option>
          <option value="Savana" title="Savana">Savana</option>
          <option value="Tundra" title="Tundra">Tundra</option>
          <option value="Vale dos Reis" title="Vale dos Reis">Vale dos Reis</option>
          <option value="Vaus do Nilo" title="Vaus do Nilo">Vaus do Nilo</option>
        </select>
      </div>

      <div class="versus">
        <div class="linha-labels">
          <label class="versusSelect1" for="versusSelect1">God 1</label>
          <label class="versusSelect2" for="versusSelect2">God 2</label>
        </div>
        <div class="linha-selects">
          <select id="versusSelect1" style="width: 100%; padding: 5px;">
            <option value="null">Selecione um Deus</option>
            <option value="amaterasu_1">Amaterasu</option>
            <option value="demeter_1">Demeter</option>
            <option value="kronos_1">Cronos</option>
            <option value="freyr_1">Frey</option>
            <option value="fuxi_1">Fuxi</option>
            <option value="gaia_1">Gaia</option>
            <option value="hades_1">Hades</option>
            <option value="isis_1">Isis</option>
            <option value="loki_1">Loki</option>
            <option value="nuwa_1">Nuwa</option>
            <option value="odin_1">Odin</option>
            <option value="poseidon_1">Poseidon</option>
            <option value="ra_1">Ra</option>
            <option value="set_1">Set</option>
            <option value="shennong_1">Shennong</option>
            <option value="susanoo_1">Susanoo</option>
            <option value="thor_1">Thor</option>
            <option value="tsukuyomi_1">Tsukuyomi</option>
            <option value="oranos_1">Urano</option>
            <option value="zeus_1">Zeus</option>
          </select>
          <select id="versusSelect2" style="width: 100%; padding: 5px;">
            <option value="null">Selecione um Deus</option>
            <option value="amaterasu_2">Amaterasu</option>
            <option value="demeter_2">Demeter</option>
            <option value="kronos_2">Cronos</option>
            <option value="freyr_2">Frey</option>
            <option value="fuxi_2">Fuxi</option>
            <option value="gaia_2">Gaia</option>
            <option value="hades_2">Hades</option>
            <option value="isis_2">Isis</option>
            <option value="loki_2">Loki</option>
            <option value="nuwa_2">Nuwa</option>
            <option value="odin_2">Odin</option>
            <option value="poseidon_2">Poseidon</option>
            <option value="ra_2">Ra</option>
            <option value="set_2">Set</option>
            <option value="shennong_2">Shennong</option>
            <option value="susanoo_2">Susanoo</option>
            <option value="thor_2">Thor</option>
            <option value="tsukuyomi_2">Tsukuyomi</option>
            <option value="oranos_2">Urano</option>
            <option value="zeus_2">Zeus</option>
          </select>
        </div>
        <div class="linha-botao">
          <button class="jogadorv1" onclick="registrarResultado(1)">Jogador 1 Venceu</button>
          <button class="jogadorv2" onclick="registrarResultado(2)">Jogador 2 Venceu</button>
        </div>
        <div class="linha-placar">
          <span id="placar1">0</span>
          <span id="placar2">0</span>
        </div>
        <div class="resultados-partidas" id="resultados-partidas"></div>
      </div>
    </div>
  </div>



  <div class="scoreboard">
    <div class="player1">
      <h3 class="section-title">
        <img id="avatarUrl1" style="margin-right: 12px;" class="avatarUrl" src="" alt="">
        Jogador 1
      </h3>
      <br>
      <div class="nome-pais">
        <button style="height: 50%" onclick="aomStatsLinkByPlayer('jogador1')" title="AoMStats Site">
          <img src="AoM/assets/aomstats-icon.png" alt="AoMStats Link">
        </button>
        <input type="text" id="jogador1" placeholder="Nome Jogador 1"
          oninput="atualizarNomesDosBotoes(); atualizarLetreiroComNomes();">
        <input type="text" id="avatar1" placeholder="Url do Avatar do Jogador 1"
          oninput="atualizarUrlAvatar(); atualizarUrlAvatar();">
        <select id="pais1" onchange="atualizarBandeira('pais1', 'bandeira1')">
          <option value="null">Selecione um País</option>
          <option value="africadosul">Africa do Sul</option>
          <option value="albania">Albania</option>
          <option value="alemanha">Alemanha</option>
          <option value="andorra">Andorra</option>
          <option value="argentina">Argentina</option>
          <option value="armenia">Armenia</option>
          <option value="australia">Australia</option>
          <option value="austria">Austria</option>
          <option value="azerbaijao">Azerbaijao</option>
          <option value="bangladesh">Bangladesh</option>
          <option value="barbados">Barbados</option>
          <option value="belgica">Belgica</option>
          <option value="bielorrussia">Bielorrussia</option>
          <option value="bolivia">Bolivia</option>
          <option value="bosnia">Bosnia</option>
          <option value="brasil">Brasil</option>
          <option value="bulgaria">Bulgaria</option>
          <option value="canada">Canada</option>
          <option value="cazaquistao">Cazaquistao</option>
          <option value="chequia">Chequia</option>
          <option value="Chile">Chile</option>
          <option value="China">China</option>
          <option value="Chipre">Chipre</option>
          <option value="colombia">Colombia</option>
          <option value="coreia">Coreia</option>
          <option value="costarica">Costa Rica</option>
          <option value="croacia">Croacia</option>
          <option value="cuba">Cuba</option>
          <option value="dinamarca">Dinamarca</option>
          <option value="egito">Egito</option>
          <option value="elsalvador">El Salvador</option>
          <option value="equador">Equador</option>
          <option value="escocia">Escocia</option>
          <option value="eslovaquia">Eslovaquia</option>
          <option value="eslovenia">Eslovenia</option>
          <option value="espanha">Espanha</option>
          <option value="estadosunidos">Estados Unidos</option>
          <option value="estonia">Estonia</option>
          <option value="finlandia">Finlandia</option>
          <option value="franca">Franca</option>
          <option value="gales">Gales</option>
          <option value="georgia">Georgia</option>
          <option value="grecia">Grecia</option>
          <option value="guatemala">Guatemala</option>
          <option value="guiana">Guiana</option>
          <option value="haiti">Haiti</option>
          <option value="holanda">Holanda</option>
          <option value="honduras">Honduras</option>
          <option value="hongkong">Hong Kong</option>
          <option value="hungria">Hungria</option>
          <option value="india">India</option>
          <option value="indonesia">Indonesia</option>
          <option value="inglaterra">Inglaterra</option>
          <option value="ira">Ira</option>
          <option value="irlanda">Irlanda</option>
          <option value="irlandanorte">Irlanda do Norte</option>
          <option value="islandia">Islandia</option>
          <option value="israel">Israel</option>
          <option value="italia">Italia</option>
          <option value="jamaica">Jamaica</option>
          <option value="japao">Japao</option>
          <option value="letonia">Letonia</option>
          <option value="liechtenstein">Liechtenstein</option>
          <option value="lituania">Lituania</option>
          <option value="luxemburgo">Luxemburgo</option>
          <option value="macedonia">Macedonia</option>
          <option value="malta">Malta</option>
          <option value="mexico">Mexico</option>
          <option value="moldavia">Moldavia</option>
          <option value="monaco">Monaco</option>
          <option value="mongolia">Mongolia</option>
          <option value="montenegro">Montenegro</option>
          <option value="nicaragua">Nicaragua</option>
          <option value="noruega">Noruega</option>
          <option value="novazelandia">Nova Zelandia</option>
          <option value="panama">Panama</option>
          <option value="paquistao">Paquistao</option>
          <option value="paraguai">Paraguai</option>
          <option value="peru">Peru</option>
          <option value="polonia">Polonia</option>
          <option value="portugal">Portugal</option>
          <option value="reinounido">Reino Unido</option>
          <option value="republicadominicana">Republica Dominicana</option>
          <option value="romenia">Romenia</option>
          <option value="russia">Russia</option>
          <option value="sanmarino">San Marino</option>
          <option value="servia">Servia</option>
          <option value="singapura">Singapura</option>
          <option value="suecia">Suecia</option>
          <option value="suica">Suica</option>
          <option value="suriname">Suriname</option>
          <option value="tailandia">Tailandia</option>
          <option value="taiwan">Taiwan</option>
          <option value="trindade">Trindade e Tobago</option>
          <option value="tunisia">Tunisia</option>
          <option value="turquia">Turquia</option>
          <option value="ucrania">Ucrania</option>
          <option value="uruguai">Uruguai</option>
          <option value="venezuela">Venezuela</option>
        </select>
        <img id="bandeira1" class="bandeira" src="" alt="">
      </div>

      <button onclick="limparMarcacoes(1)">Limpar Draft</button>

      <div class="picks-bans">
        <div class="section-title">Gods</div>
        <div class="item-grid god-grid" data-jogador="1"></div>

        <div class="section-title">
          <select class="filtro-mapas-grid" data-jogador="1" onchange="atualizarGridMapas(1)"
            style="background: transparent; color: white; border: none; font-weight: bold; font-family: inherit; font-size: inherit; cursor: pointer; text-align: center;">
            <option style="color: black" value="torneio" selected>Mapas do Torneio de Verão</option>
            <option style="color: black" value="todos">Todos os Mapas</option>
          </select>
        </div>
        <div class="item-grid map-grid" data-jogador="1"></div>


      </div>
    </div>

    <div class="player2">
      <h3 class="section-title">
        <img id="avatarUrl2" style="margin-right: 12px;" class="avatarUrl" src="" alt="">
        Jogador 2
      </h3>
      <br>
      <div class="nome-pais">
        <button style="height: 50%" onclick="aomStatsLinkByPlayer('jogador2')" title="AoMStats Site">
          <img src="AoM/assets/aomstats-icon.png" alt="AoMStats Link">
        </button>
        <input type="text" id="jogador2" placeholder="Nome Jogador 2"
          oninput="atualizarNomesDosBotoes(); atualizarLetreiroComNomes();">
        <input type="text" id="avatar2" placeholder="Url do Avatar do Jogador 2"
          oninput="atualizarUrlAvatar(); atualizarUrlAvatar();">
        <select id="pais2" onchange="atualizarBandeira('pais2', 'bandeira2')">
          <option value="null">Selecione um País</option>
          <option value="africadosul">Africa do Sul</option>
          <option value="albania">Albania</option>
          <option value="alemanha">Alemanha</option>
          <option value="andorra">Andorra</option>
          <option value="argentina">Argentina</option>
          <option value="armenia">Armenia</option>
          <option value="australia">Australia</option>
          <option value="austria">Austria</option>
          <option value="azerbaijao">Azerbaijao</option>
          <option value="bangladesh">Bangladesh</option>
          <option value="barbados">Barbados</option>
          <option value="belgica">Belgica</option>
          <option value="bielorrussia">Bielorrussia</option>
          <option value="bolivia">Bolivia</option>
          <option value="bosnia">Bosnia</option>
          <option value="brasil">Brasil</option>
          <option value="bulgaria">Bulgaria</option>
          <option value="canada">Canada</option>
          <option value="cazaquistao">Cazaquistao</option>
          <option value="chequia">Chequia</option>
          <option value="Chile">Chile</option>
          <option value="China">China</option>
          <option value="Chipre">Chipre</option>
          <option value="colombia">Colombia</option>
          <option value="coreia">Coreia</option>
          <option value="costarica">Costa Rica</option>
          <option value="croacia">Croacia</option>
          <option value="cuba">Cuba</option>
          <option value="dinamarca">Dinamarca</option>
          <option value="egito">Egito</option>
          <option value="elsalvador">El Salvador</option>
          <option value="equador">Equador</option>
          <option value="escocia">Escocia</option>
          <option value="eslovaquia">Eslovaquia</option>
          <option value="eslovenia">Eslovenia</option>
          <option value="espanha">Espanha</option>
          <option value="estadosunidos">Estados Unidos</option>
          <option value="estonia">Estonia</option>
          <option value="finlandia">Finlandia</option>
          <option value="franca">Franca</option>
          <option value="gales">Gales</option>
          <option value="georgia">Georgia</option>
          <option value="grecia">Grecia</option>
          <option value="guatemala">Guatemala</option>
          <option value="guiana">Guiana</option>
          <option value="haiti">Haiti</option>
          <option value="holanda">Holanda</option>
          <option value="honduras">Honduras</option>
          <option value="hongkong">Hong Kong</option>
          <option value="hungria">Hungria</option>
          <option value="india">India</option>
          <option value="indonesia">Indonesia</option>
          <option value="inglaterra">Inglaterra</option>
          <option value="ira">Ira</option>
          <option value="irlanda">Irlanda</option>
          <option value="irlandanorte">Irlanda do Norte</option>
          <option value="islandia">Islandia</option>
          <option value="israel">Israel</option>
          <option value="italia">Italia</option>
          <option value="jamaica">Jamaica</option>
          <option value="japao">Japao</option>
          <option value="letonia">Letonia</option>
          <option value="liechtenstein">Liechtenstein</option>
          <option value="lituania">Lituania</option>
          <option value="luxemburgo">Luxemburgo</option>
          <option value="macedonia">Macedonia</option>
          <option value="malta">Malta</option>
          <option value="mexico">Mexico</option>
          <option value="moldavia">Moldavia</option>
          <option value="monaco">Monaco</option>
          <option value="mongolia">Mongolia</option>
          <option value="montenegro">Montenegro</option>
          <option value="nicaragua">Nicaragua</option>
          <option value="noruega">Noruega</option>
          <option value="novazelandia">Nova Zelandia</option>
          <option value="panama">Panama</option>
          <option value="paquistao">Paquistao</option>
          <option value="paraguai">Paraguai</option>
          <option value="peru">Peru</option>
          <option value="polonia">Polonia</option>
          <option value="portugal">Portugal</option>
          <option value="reinounido">Reino Unido</option>
          <option value="republicadominicana">Republica Dominicana</option>
          <option value="romenia">Romenia</option>
          <option value="russia">Russia</option>
          <option value="sanmarino">San Marino</option>
          <option value="servia">Servia</option>
          <option value="singapura">Singapura</option>
          <option value="suecia">Suecia</option>
          <option value="suica">Suica</option>
          <option value="suriname">Suriname</option>
          <option value="tailandia">Tailandia</option>
          <option value="taiwan">Taiwan</option>
          <option value="trindade">Trindade e Tobago</option>
          <option value="tunisia">Tunisia</option>
          <option value="turquia">Turquia</option>
          <option value="ucrania">Ucrania</option>
          <option value="uruguai">Uruguai</option>
          <option value="venezuela">Venezuela</option>
        </select>
        <img id="bandeira2" class="bandeira" src="" alt="">
      </div>

      <button onclick="limparMarcacoes(2)">Limpar Draft</button>

      <div class="picks-bans">
        <div class="section-title">Gods</div>
        <div class="item-grid god-grid" data-jogador="2"></div>

        <div class="section-title">
          <select class="filtro-mapas-grid" data-jogador="2" onchange="atualizarGridMapas(2)"
            style="background: transparent; color: white; border: none; font-weight: bold; font-family: inherit; font-size: inherit; cursor: pointer; text-align: center;">
            <option style="color: black" value="torneio" selected>Mapas do Torneio de Verão</option>
            <option style="color: black" value="todos">Todos os Mapas</option>
          </select>
        </div>
        <div class="item-grid map-grid" data-jogador="2"></div>
      </div>
    </div>
  </div>

  <script>
    const gods = ['poseidon', 'zeus', 'hades', 'demeter', 'ra', 'isis', 'set', 'thor', 'odin', 'loki', 'freyr', 'kronos', 'oranos', 'gaia', 'nuwa', 'fuxi', 'shennong', 'amaterasu', 'tsukuyomi', 'susanoo'];

    const allMaps = ['random', 'acropolis', 'air', 'alfheim', 'anatolia', 'archipelago', 'arena', 'asograsslands', 'bamboogrove', 'blacksea', 'bluelagoon', 'elysium', 'erebus', 'ghostlake', 'giza', 'goldrush', 'highland', 'ironwood', 'islands', 'jotunheim', 'kerlaugar', 'kii', 'landunknown', 'landnomad', 'marsh', 'mediterranean', 'megalopolis', 'midgard', 'mirage', 'mirkwood', 'mountolympus', 'muspellheim', 'nileshallows', 'nomad', 'oasis', 'okuchichibu', 'peachblossomland', 'rivernile', 'riverstyx', 'savannah', 'seaofworms', 'senjogahara', 'setonaikai', 'silkroad', 'snakedance', 'steppe', 'teammigration', 'tundra', 'valleyofkings', 'vindlandsaga', 'wateringhole', 'yellowriver'];

    const summerTournamentMaps = ['alfheim', 'air', 'buracodagua', 'elisio', 'estepe', 'gize', 'kii', 'lagofantasma', 'lagoaazul', 'mediterraneo', 'megalopole', 'oasis', 'pantano', 'savana', 'tundra', 'valedosreis', 'vausdonilo'];

    // Mantemos a variável 'maps' para compatibilidade com o restante do código de carregamento de ícones
    let maps = [...summerTournamentMaps];

    function atualizarGridMapas(jogador) {
      const filtro = document.querySelector(`.filtro-mapas-grid[data-jogador="${jogador}"]`).value;
      const container = document.querySelector(`.map-grid[data-jogador="${jogador}"]`);
      const listaParaUsar = filtro === 'torneio' ? summerTournamentMaps : allMaps;

      // Limpa a grade atual
      container.innerHTML = '';

      // Recarrega os itens baseados na lista selecionada
      listaParaUsar.forEach(nome => {
        const img = document.createElement('img');
        img.src = `AoM/assets/mapas/${nome}.png`;
        img.alt = nome;
        img.dataset.nome = nome;
        img.dataset.estado = '';
        img.classList.add('item-img');
        img.onclick = () => { alternarEstadoImagem(img, 'pick', 'mapas'); };
        img.oncontextmenu = (e) => {
          e.preventDefault();
          alternarEstadoImagem(img, 'ban', 'mapas');
        };
        container.appendChild(img);
      });
    }

    function processarLogoCamp(event) {
      const arquivo = event.target.files[0];
      const botao = document.getElementById('btnLogoCamp');
      const inputOculto = document.getElementById('logo_camp');
      const previewImg = document.getElementById('logoPreview');
      const previewContainer = document.getElementById('previewContainer');

      if (arquivo) {
        // 1. Pega o nome sem extensão e atualiza o sistema
        const nomeSemExtensao = arquivo.name.replace(/\.[^/.]+$/, "");
        inputOculto.value = nomeSemExtensao;

        // 2. Atualiza o texto do botão
        botao.innerText = "Logo: " + nomeSemExtensao;
        botao.style.backgroundColor = "#2e7d32";

        // 3. Gera a prévia da imagem
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result; // Define o src da imagem como o conteúdo do arquivo
          previewContainer.style.display = "flex"; // Mostra o container
        };
        reader.readAsDataURL(arquivo);

        // Limpa o input file
        event.target.value = '';
      }
    }
    function atualizarTodosCampos(salvos) {
      const linhas = JSON.parse(salvos);
      let dados = {};
      linhas.forEach(linha => {
        const [chave, valor] = linha.split('=');
        if (chave && valor !== undefined) dados[chave.trim()] = valor.trim();
      });

      if (dados.jogador_1) {
        document.getElementById("jogador1").value = dados.jogador_1;
        document.querySelector(".jogadorv1").textContent = `${dados.jogador_1} Venceu`;
      }

      if (dados.jogador_2) {
        document.getElementById("jogador2").value = dados.jogador_2;
        document.querySelector(".jogadorv2").textContent = `${dados.jogador_2} Venceu`;
      }

      // Restaurar campos básicos
      if (dados.logo_camp) document.getElementById("logo_camp").value = dados.logo_camp;
      if (dados.mapa) document.getElementById("mapaSelect").value = dados.mapa;

      if (dados.letreiro) document.getElementById("letreiro").value = dados.letreiro;
      if (dados.flagE) {
        const cor1 = dados.flagE.replace('flagE_', '');
        document.getElementById('cor1').value = cor1;
      }
      if (dados.flagD) {
        const cor2 = dados.flagD.replace('flagD_', '');
        document.getElementById('cor2').value = cor2;
      }

      if (dados.gods) {
        const [g1, g2] = dados.gods.split(',');
        document.getElementById("versusSelect1").value = g1;
        document.getElementById("versusSelect2").value = g2;
      }

      if (dados.placar_1) document.getElementById("placar1").textContent = dados.placar_1;
      if (dados.placar_2) document.getElementById("placar2").textContent = dados.placar_2;

      if (dados.jogador_1) document.getElementById("jogador1").value = dados.jogador_1;
      if (dados.jogador_2) document.getElementById("jogador2").value = dados.jogador_2;

      if (dados.avatar_1) {
        document.getElementById("avatar1").value = dados.avatar_1
        document.getElementById("avatarUrl1").src = dados.avatar_1
      };
      if (dados.avatar_2) {
        document.getElementById("avatar2").value = dados.avatar_2;
        document.getElementById("avatarUrl2").src = dados.avatar_2
      }

      if (dados.pais_1) {
        document.getElementById("pais1").value = dados.pais_1;
        atualizarBandeira("pais1", "bandeira1");
      }
      if (dados.pais_2) {
        document.getElementById("pais2").value = dados.pais_2;
        atualizarBandeira("pais2", "bandeira2");
      }

      // Restaurar draft gods e mapas para jogadores 1 e 2
      restaurarDraft(1, 'god', dados);
      restaurarDraft(1, 'map', dados);
      restaurarDraft(2, 'god', dados);
      restaurarDraft(2, 'map', dados);

      if (dados.cor1) {
        document.getElementById('cor1').value = dados.cor1;
      }
      if (dados.cor2) {
        document.getElementById('cor2').value = dados.cor2;
      }

      // NOVO: Aplica as cores de fundo
      trocarCorDeFundo();

      exibirPartidas(dados);
    }

    window.onload = () => {

      carregarItens('god', 1);
      carregarItens('god', 2);
      carregarItens('map', 1);
      carregarItens('map', 2);
      atualizarSelectMapas();

      // Restaurar dados do localStorage, se houver
      const salvos = localStorage.getItem("dadosInterface");
      if (salvos) {
        atualizarTodosCampos(salvos);
      }
    };


    // Função customizada para substitutir o customAlert()
    const customAlert = (message, type) => {
      const typeAlert = type || 'Aviso';
      let typeHtml = '<div style="background-color: #2E2E2E; color: white; padding: 10px; border-radius: 5px;"> ' + typeAlert + '</div>';

      if (typeAlert === 'Error') {
        typeHtml = '<div style="background-color: #2E2E2E; color: #FF6B6B; padding: 10px; border-radius: 5px;"> ❌ ' + typeAlert + ' ❌</div>';
      }

      const modal = document.createElement('div');
      modal.style.cssText = `
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.7); display: flex; justify-content: center;
          align-items: center; z-index: 1000;
        `;
      const content = document.createElement('div');
      content.style.cssText = `
          background: #383838; padding: 20px; border-radius: 8px;
          color: white; text-align: center; max-width: 300px;
        `;
      content.innerHTML = `${typeHtml}<p>${message}</p>
          <button id="confirm-ok" style="background-color: #007bff;">OK</button>`;

      modal.appendChild(content);
      document.body.appendChild(modal);

      document.getElementById('confirm-ok').onclick = () => {
        document.body.removeChild(modal);
      };
    };

    const confirmAlert = (title, message, onConfirm) => {
      const titleAlert = title;
      let titleHtml = titleAlert ? '<div style="background-color: #2E2E2E; color: white; padding: 10px; border-radius: 5px;"> ' + titleAlert + '</div>' : '';
      const modal = document.createElement('div');
      modal.style.cssText = `
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.7); display: flex; justify-content: center;
          align-items: center; z-index: 1000;
        `;
      const content = document.createElement('div');
      content.style.cssText = `
          background: #383838; padding: 20px; border-radius: 8px;
           text-align: center; max-width: 300px;
        `;
      content.innerHTML = `${titleHtml}<p>${message}</p>
          <button id="confirm-yes" style="margin-right: 10px; background-color: #4CAF50;">Sim</button>
          <button id="confirm-no" style="background-color: #dc3545;">Não</button>`;

      modal.appendChild(content);
      document.body.appendChild(modal);

      document.getElementById('confirm-yes').onclick = () => {
        onConfirm();
        document.body.removeChild(modal);
      };
      document.getElementById('confirm-no').onclick = () => {
        document.body.removeChild(modal);
      };
    };

    function atualizarBandeira(selectId, imgId) {
      const pais = document.getElementById(selectId).value;
      const img = document.getElementById(imgId);
      if (pais) {
        img.src = `AoM/assets/bandeiras/${pais}.png`;
        img.alt = pais;
      } else {
        img.src = "";
        img.alt = "";
      }
    }

    function atualizarUrlAvatar() {
      const avatar1 = document.getElementById("avatar1").value;
      const avatar2 = document.getElementById("avatar2").value;

      if (avatar1) document.getElementById("avatarUrl1").src = avatar1;
      if (avatar2) document.getElementById("avatarUrl2").src = avatar2;
    }

    function atualizarNomesDosBotoes() {
      const nome1 = document.getElementById("jogador1").value || "Jogador 1";
      const nome2 = document.getElementById("jogador2").value || "Jogador 2";

      document.querySelector(".jogadorv1").textContent = `${nome1} Venceu`;
      document.querySelector(".jogadorv2").textContent = `${nome2} Venceu`;
    }


    function carregarItens(tipo, jogador) {
      const container = document.querySelector(`.${tipo}-grid[data-jogador="${jogador}"]`);
      const itens = tipo === 'god' ? gods : maps;
      const pasta = tipo === 'god' ? 'gods' : 'mapas';

      itens.forEach(nome => {
        const img = document.createElement('img');
        img.src = `AoM/assets/${pasta}/${nome}.png`;
        img.alt = nome;
        img.dataset.nome = nome;
        img.dataset.estado = '';
        img.classList.add('item-img');

        img.onclick = () => {
          alternarEstadoImagem(img, 'pick', pasta);
        };

        img.oncontextmenu = (e) => {
          e.preventDefault();
          alternarEstadoImagem(img, 'ban', pasta);
        };

        container.appendChild(img);
      });
    }

    function atualizarLetreiroComNomes() {
      const nome1 = document.getElementById("jogador1").value || "Player 1";
      const nome2 = document.getElementById("jogador2").value || "Player 2";

      const letreiroSelect = document.getElementById("letreiro");
      letreiroSelect.options[0].textContent = `${nome1} | ${nome2}`;
      letreiroSelect.options[1].textContent = `${nome2} | ${nome1}`;
    }


    function alternarEstadoImagem(img, tipo, pasta) {
      const nome = img.dataset.nome;
      const estadoAtual = img.dataset.estado;

      if (tipo === 'pick') {
        if (estadoAtual === 'pick') {
          img.src = `AoM/assets/${pasta}/${nome}.png`;
          img.dataset.estado = '';
        } else {
          img.src = `AoM/assets/${pasta}/${nome}_p.png`;
          img.dataset.estado = 'pick';
        }
      } else if (tipo === 'ban') {
        if (estadoAtual === 'ban') {
          img.src = `AoM/assets/${pasta}/${nome}.png`;
          img.dataset.estado = '';
        } else {
          img.src = `AoM/assets/${pasta}/${nome}_b.png`;
          img.dataset.estado = 'ban';
        }
      }
    }

    function exibirPartidas(dados) {
      const container = document.getElementById('resultados-partidas');
      container.innerHTML = '';
      if (!dados) {
        container.innerHTML = '';
        return;
      }

      // 1. Coletar todas as partidas com seus índices originais (Lógica Mantida)
      let partidasComIndex = [];
      for (let i = 1; i <= 99; i++) {
        const key = `partida${i}`;
        if (dados[key]) {
          partidasComIndex.push({
            index: i,
            data: dados[key]
          });
        }
      }

      // 2. Aplicar a lógica de exibir apenas as últimas 6 (Lógica Mantida)
      let partidasParaExibir = partidasComIndex;
      if (partidasComIndex.length > 6) {
        partidasParaExibir = partidasComIndex.slice(-6);
      }

      partidasParaExibir.forEach(partidaObj => {
        const linha = partidaObj.data;
        const index = partidaObj.index; // O índice correto para exclusão

        const valores = linha.split(',');
        if (valores.length < 4) return;
        const [vencInfo, perdDeus, mapa, vencedorValor] = valores.map(s => s.trim());
        if (!vencInfo || !perdDeus || !mapa || !vencedorValor) return;

        // --- Lógica de Parsing ---

        // 1. Extrai o nome do vencedor e o deus vencedor do primeiro elemento
        const vencInfoLimpo = vencInfo.replace(/^\d+\.\s*/, "");
        let [nomeVencedor, godVencedor] = vencInfoLimpo.split(':').map(s => s.trim());

        const godPerdedor = perdDeus;

        // 2. Obter nomes atuais dos jogadores na interface
        const nomeJogador1 = document.getElementById('jogador1') ? document.getElementById('jogador1').value : 'Jogador 1';
        const nomeJogador2 = document.getElementById('jogador2') ? document.getElementById('jogador2').value : 'Jogador 2';

        // 3. Determinação do Índice do Vencedor (Lógica HÍBRIDA Corrigida)
        let jogadorIndexVencedor;
        const nomeVencedorLower = nomeVencedor.toLowerCase();

        // Tenta corresponder ao nome real da interface (Ex: Scooby, Light)
        if (nomeVencedorLower === nomeJogador1.toLowerCase()) {
          jogadorIndexVencedor = 1;
        } else if (nomeVencedorLower === nomeJogador2.toLowerCase()) {
          jogadorIndexVencedor = 2;
        }
        // FALLBACK para dados históricos (Ex: Jogador 1, Jogador 2)
        else if (nomeVencedorLower === 'jogador 1') {
          jogadorIndexVencedor = 1;
        } else if (nomeVencedorLower === 'jogador 2') {
          jogadorIndexVencedor = 2;
        } else {
          // Se o nome salvo não corresponde a nada conhecido, ignora a partida
          console.warn(`Nome do Vencedor (${nomeVencedor}) é desconhecido. Ignorando partida ${index}.`);
          return;
        }

        let jogadorIndexPerdedor = (jogadorIndexVencedor === 1) ? 2 : 1;

        // ---------------------------------------------

        // 3. Obter o Deus de cada JOGADOR e determinar quem perdeu
        let deusJ1 = '';
        let deusJ2 = '';
        let classeCinzaJ1 = '';
        let classeCinzaJ2 = '';

        // Se J1 venceu (index 1)
        if (jogadorIndexVencedor == 1) {
          deusJ1 = godVencedor;
          deusJ2 = godPerdedor;
        } else { // Se J2 venceu (index 2)
          deusJ2 = godVencedor;
          deusJ1 = godPerdedor;
        }

        // Aplica a classe 'cinza' ao perdedor
        if (jogadorIndexPerdedor == 1) {
          classeCinzaJ1 = ' cinza';
        } else {
          classeCinzaJ2 = ' cinza';
        }

        // 4. Determinar a classe de cor/lado (Lógica Mantida)
        const mapaNormalizado = mapa.toLowerCase().replace(/\s/g, '');
        let classeCor = vencedorValor === 'A' ? 'esquerda' : 'direita';

        // 5. Geração do HTML da Partida (Lógica Mantida)
        const partidaDiv = document.createElement('div');
        partidaDiv.className = `partida ${classeCor}`;

        // O HTML é montado sempre na ordem: JOGADOR 1 (ESQUERDA) VS JOGADOR 2 (DIREITA)
        partidaDiv.innerHTML = `
            <span class="nome${classeCinzaJ1}">${nomeJogador1}</span>
            <img class="deus-img${classeCinzaJ1}" src="AoM/assets/gods/${deusJ1}.png" alt="${deusJ1}">
            <span style="font-weight: bold; margin: 0 5px;">VS</span>
            <img class="deus-img${classeCinzaJ2}" src="AoM/assets/gods/${deusJ2}.png" alt="${deusJ2}">
            <span class="nome${classeCinzaJ2}">${nomeJogador2}</span>
            <img class="mapa-img" src="AoM/assets/mapas/${mapaNormalizado}.png" alt="${mapa}">
            
            <button onclick="excluirPartida(${index})" style="background-color: darkred; padding: 2px 5px; margin-left: 10px; font-weight: bold;">X</button>
        `;
        container.appendChild(partidaDiv);
      });
      trocarCorDeFundo();
    }

    // [NOVA FUNÇÃO] - Para excluir uma partida
    function excluirPartida(index) {
      confirmAlert("Excluir Partida", `Tem certeza que deseja excluir a Partida ${index}? Isso também removerá 1 ponto do placar do vencedor.`, () => {
        // 1. Carregar dados existentes
        const salvos = localStorage.getItem("dadosInterface");
        let linhas = salvos ? JSON.parse(salvos) : [];
        const dados = {};
        linhas.forEach(linha => {
          const [chave, valor] = linha.split('=');
          if (chave && valor !== undefined) dados[chave.trim()] = valor.trim();
        });

        const chavePartida = `partida${index}`;
        const partidaExcluida = dados[chavePartida];

        if (!partidaExcluida) {
          customAlert("Partida não encontrada para exclusão.", "Error");
          return;
        }

        // 2. Ajustar o placar
        const valores = partidaExcluida.split(',');
        const vencedorValor = valores[3].trim(); // 'A' (J1) ou 'B' (J2)

        let placar1 = parseInt(dados["placar_1"] || 0);
        let placar2 = parseInt(dados["placar_2"] || 0);

        if (vencedorValor === 'A') {
          placar1 = Math.max(0, placar1 - 1);
        } else if (vencedorValor === 'B') {
          placar2 = Math.max(0, placar2 - 1);
        }

        // Atualiza os placares no objeto de dados
        dados["placar_1"] = String(placar1);
        dados["placar_2"] = String(placar2);

        // 3. Remover a partida e re-indexar as seguintes
        delete dados[chavePartida];

        // Re-indexar: Move todas as partidas posteriores para cima
        for (let i = index + 1; i <= 99; i++) {
          const oldKey = `partida${i}`;
          const newKey = `partida${i - 1}`;

          if (dados[oldKey]) {
            dados[newKey] = dados[oldKey];
            delete dados[oldKey];
          } else {
            break;
          }
        }

        // 4. Reconstruir o array 'linhas' para salvar no localStorage
        let novasLinhas = [];
        let partidasRestantes = [];

        // Preservar todos os dados que não são 'partida' ou 'placar'
        linhas.forEach(linha => {
          const [chave] = linha.split('=');
          const chaveLimpa = chave.trim();
          if (!chaveLimpa.startsWith("partida") && !chaveLimpa.startsWith("placar_")) {
            novasLinhas.push(linha);
          }
        });

        // Adicionar placares atualizados
        novasLinhas.push(`placar_1= ${dados["placar_1"]}`);
        novasLinhas.push(`placar_2= ${dados["placar_2"]}`);

        // Coletar as partidas restantes do objeto de dados
        for (let i = 1; i <= 99; i++) {
          const key = `partida${i}`;
          if (dados[key]) {
            partidasRestantes.push(dados[key]);
          }
        }

        // Re-adicionar as partidas restantes com indexação sequencial correta
        partidasRestantes.forEach((partida, i) => {
          novasLinhas.push(`partida${i + 1}= ${partida}`);
        });


        // 5. Salvar novos dados
        localStorage.setItem("dadosInterface", JSON.stringify(novasLinhas));

        // 6. Atualizar a interface
        atualizarTodosCampos(JSON.stringify(novasLinhas));
        customAlert("Partida excluída e placar ajustado com sucesso!", 'Sucesso');
      });
    }

    // SALVAR RESULTADO PARTIDA
    function registrarResultado(vencedorId) {
      const mapa = document.getElementById("mapaSelect").value;
      const g1 = document.getElementById("versusSelect1").value.replace("_1", "");
      const g2 = document.getElementById("versusSelect2").value.replace("_2", "");
      const j1 = document.getElementById("jogador1").value || "Jogador 1";
      const j2 = document.getElementById("jogador2").value || "Jogador 2";

      if (mapa === "null" || g1 === "null" || g2 === "null") {
        customAlert("Preencha todos os campos corretamente para registrar o resultado.", "Error");
        return;
      }

      confirmAlert("Marcar Vencedor", "Essa ação marcará +1 ponto para o jogador escolhido como vencedor.<br><br>Tem certeza que deseja registrar o resultado da partida?", () => {
        // Atualiza o placar direto no DOM
        const placar1El = document.getElementById("placar1");
        const placar2El = document.getElementById("placar2");

        if (vencedorId === 1) {
          placar1El.textContent = parseInt(placar1El.textContent) + 1;
        } else {
          placar2El.textContent = parseInt(placar2El.textContent) + 1;
        }

        const valorJogador1 = "A";
        const valorJogador2 = "B";
        const vencedorValor = vencedorId === 1 ? valorJogador1 : valorJogador2;
        const vencedorNome = vencedorId === 1 ? j1 : j2;
        const vencedorGod = vencedorId === 1 ? g1 : g2;
        const perdedorGod = vencedorId === 1 ? g2 : g1;

        const novaPartida = `${vencedorNome}:${vencedorGod},${perdedorGod},${mapa},${vencedorValor}`;
        // Carrega dados existentes
        const salvos = localStorage.getItem("dadosInterface");
        const linhas = salvos ? JSON.parse(salvos) : [];
        const dados = {};
        linhas.forEach(linha => {
          const [chave, valor] = linha.split('=');
          if (chave && valor !== undefined) dados[chave.trim()] = valor.trim();
        });

        // Atualiza placar no objeto de dados
        if (vencedorId === 1) {
          placar1El.textContent = parseInt(placar1El.textContent);
        } else {
          placar2El.textContent = parseInt(placar2El.textContent);
        }
        dados["placar_1"] = placar1El.textContent;
        dados["placar_2"] = placar2El.textContent;

        // Registra a nova partida
        for (let i = 1; i <= 9; i++) {
          const partida = dados[`partida${i}`];
          const textoLimpo = partida ? partida.replace(/^\d+\.\s*/, "") : "";
          if (!textoLimpo || textoLimpo === ":,") {
            dados[`partida${i}`] = novaPartida;
            break;
          }
        }

        // Atualiza localStorage e salva no txt
        const novasLinhas = Object.entries(dados).map(([k, v]) => {
          if (k.startsWith("partida")) {
            const num = k.replace("partida", "");
            const semPrefixo = v.replace(/^\d+\.\s*/, ""); // remove "1. ", "2. ", etc.
            return `${k}= ${num}. ${semPrefixo}`;
          }
          return `${k}= ${v}`;
        });

        localStorage.setItem("dadosInterface", JSON.stringify(novasLinhas));

        atualizarTodosCampos(JSON.stringify(novasLinhas));

        const blob = new Blob([novasLinhas.join("\n")], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "dados.txt";
        link.click();
      })
    }

    function limparMarcacoes(jogador) {
      confirmAlert("Limpar Draft", "Essa ação irá remover todos os picks e bans dos gods e mapas desse jogador.<br><br>Tem certeza que deseja limpar o draft?", () => {
        ['god', 'map'].forEach(tipo => {
          const pasta = tipo === 'god' ? 'gods' : 'mapas';
          const imgs = document.querySelectorAll(`.${tipo}-grid[data-jogador="${jogador}"] .item-img`);
          imgs.forEach(img => {
            const nome = img.dataset.nome;
            img.src = `AoM/assets/${pasta}/${nome}.png`;
            img.dataset.estado = '';
          });
        });
      })
    }


    function salvarDadosLocal() {
      // mesma lógica de salvarDados, mas só salva no localStorage, sem criar arquivo
      const dados = [];

      function coletarDraft(jogador, tipo) {
        const pasta = tipo === 'god' ? 'gods' : 'mapas';
        const imagens = document.querySelectorAll(`.${tipo}-grid[data-jogador="${jogador}"] .item-img`);
        const picks = [];
        const bans = [];

        imagens.forEach(img => {
          const nome = img.dataset.nome;
          const estado = img.dataset.estado;
          if (estado === 'pick') picks.push(` ${nome}_p`);
          if (estado === 'ban') bans.push(`${nome}_b`);
        });

        return [...picks, ...bans];
      }

      dados.push('interface= 1');
      dados.push(`letreiro= ${document.getElementById('letreiro').value}`);
      dados.push(`logo_camp= ${document.getElementById('logo_camp').value}`);

      dados.push(`mapa= ${document.getElementById('mapaSelect').value}`);
      const g1 = document.getElementById('versusSelect1').value || "null_1";
      const g2 = document.getElementById('versusSelect2').value || "null_2";
      dados.push(`gods= ${g1},${g2}`);

      dados.push(`placar_1= ${document.getElementById('placar1').textContent}`);
      dados.push(`jogador_1= ${document.getElementById('jogador1').value}`);
      dados.push(`pais_1= ${document.getElementById('pais1').value}`);
      dados.push(`avatar_1= ${document.getElementById('avatar1').value}`);
      dados.push(`gods_1= ${coletarDraft(1, 'god').join(',') || 'null'}`);
      dados.push(`maps_1= ${coletarDraft(1, 'map').join(',') || 'null'}`);

      dados.push(`placar_2= ${document.getElementById('placar2').textContent}`);
      dados.push(`jogador_2= ${document.getElementById('jogador2').value}`);
      dados.push(`pais_2= ${document.getElementById('pais2').value}`);
      dados.push(`avatar_2= ${document.getElementById('avatar2').value}`);
      dados.push(`gods_2= ${coletarDraft(2, 'god').join(',') || 'null'}`);
      dados.push(`maps_2= ${coletarDraft(2, 'map').join(',') || 'null'}`);

      dados.push(`cor1= ${document.getElementById('cor1').value}`);
      dados.push(`cor2= ${document.getElementById('cor2').value}`);

      localStorage.setItem("dadosInterface", JSON.stringify(dados));
    }

    // === Carregar dados do localStorage ao abrir a página ===
    window.addEventListener("DOMContentLoaded", () => {
      const dadosSalvos = localStorage.getItem("dadosInterface");
      if (!dadosSalvos) return;

      const linhas = JSON.parse(dadosSalvos);
      const mapa = {};

      linhas.forEach(linha => {
        const [chave, valor] = linha.split("=").map(s => s.trim());
        mapa[chave] = valor;
      });

      // --- Restaura os principais campos ---
      if (mapa.letreiro) document.getElementById("letreiro").value = mapa.letreiro;

      // ATUALIZAÇÃO LOGO: Restaura o valor oculto e o texto do botão
      if (mapa.logo_camp) {
        document.getElementById("logo_camp").value = mapa.logo_camp;
        const btn = document.getElementById("btnLogoCamp");
        if (btn) btn.innerText = "Logo: " + mapa.logo_camp;
        // Nota: A imagem real (preview) não volta aqui porque o navegador não tem acesso 
        // ao caminho do seu computador por segurança, mas o nome do arquivo estará lá.
      }

      if (mapa.mapa) document.getElementById("mapaSelect").value = mapa.mapa;
      if (mapa.jogador_1) document.getElementById("jogador1").value = mapa.jogador_1;
      if (mapa.jogador_2) document.getElementById("jogador2").value = mapa.jogador_2;
      if (mapa.pais_1) document.getElementById("pais1").value = mapa.pais_1;
      if (mapa.pais_2) document.getElementById("pais2").value = mapa.pais_2;
      if (mapa.avatar_1) document.getElementById("avatar1").textContent = mapa.avatar_1;
      if (mapa.avatar_2) document.getElementById("avatar2").textContent = mapa.avatar_2;

      // ATUALIZAÇÃO MAPAS: Garante que as grids de mapas sejam desenhadas
      if (typeof atualizarGridMapas === "function") {
        atualizarGridMapas(1);
        atualizarGridMapas(2);
      }

      if (typeof atualizarLetreiroComNomes === "function") {
        atualizarLetreiroComNomes();
      }

      console.log("✅ Dados restaurados do localStorage");
    });


    function salvarDados() {
      confirmAlert("Deseja salvar os dados?", "Essa ação vai gerar um arquivo  <span style='color: gray ;'>dados.txt</span> que deve ser colado na pasta ao lado do <span style='color: gray ;'> gerenciador_dados.html </span>", () => {


        // 1. VALIDAÇÃO DOS CAMPOS OBRIGATÓRIOS
        const camposObrigatorios = [
          { id: 'letreiro', nome: 'Letreiro' },
          { id: 'logo_camp', nome: 'Campeonato' },
          { id: 'jogador1', nome: 'Jogador 1' },
          { id: 'cor1', nome: 'Cor Esquerda' },
          { id: 'jogador2', nome: 'Jogador 2' },
          { id: 'cor2', nome: 'Cor Direita' },
          { id: 'mapaSelect', nome: 'Mapa' },
          { id: 'versusSelect1', nome: 'God 1 (Versus)' },
          { id: 'versusSelect2', nome: 'God 2 (Versus)' }
        ];

        const camposFaltantes = [];

        camposObrigatorios.forEach(campo => {
          const elemento = document.getElementById(campo.id);
          if (!elemento) return;

          let valor = elemento.value.trim();
          let isMissing = false;

          // Verifica se o valor é vazio
          if (valor === '') {
            isMissing = true;
          }
          // Verifica se é um select e o valor é 'null' (opção de "Selecione...")
          else if (elemento.tagName === 'SELECT' && valor === 'null') {
            isMissing = true;
          }

          if (isMissing) {
            camposFaltantes.push(campo.nome);
            // Adiciona borda vermelha para feedback visual
            elemento.style.border = '2px solid red';
          } else {
            // Remove a borda vermelha se o campo for válido (limpando o estado de erro anterior)
            elemento.style.border = '1px solid transparent';
          }
        });

        if (camposFaltantes.length > 0) {
          customAlert(`Erro ao Salvar:\n\nPor favor, preencha ou selecione os seguintes campos obrigatórios:\n\n- ${camposFaltantes.join("\n- ")}`, 'Error');
          // Interrompe a função, impedindo o download
          return;
        }

        // 2. SALVAMENTO (se a validação passar)
        const dados = [];

        function coletarDraft(jogador, tipo) {
          const pasta = tipo === 'god' ? 'gods' : 'mapas';
          const imagens = document.querySelectorAll(`.${tipo}-grid[data-jogador="${jogador}"] .item-img`);
          const picks = [];
          const bans = [];

          imagens.forEach(img => {
            const nome = img.dataset.nome;
            const estado = img.dataset.estado;
            if (estado === 'pick') picks.push(`${nome}_p`);
            if (estado === 'ban') bans.push(`${nome}_b`);
          });

          return [...picks, ...bans]; // picks primeiro, depois bans
        }


        dados.push(`letreiro= ${document.getElementById('letreiro').value}`);

        dados.push(`\nlogo_camp= ${document.getElementById('logo_camp').value}`);
        dados.push('logo_streamer= logo-julian-rda');

        dados.push(`\nmapa= ${document.getElementById('mapaSelect').value}`);
        const g1 = document.getElementById('versusSelect1').value || "null_1";
        const g2 = document.getElementById('versusSelect2').value || "null_2";
        dados.push(`gods= ${g1},${g2}`);
        dados.push('mostrar_avatar= sim');

        dados.push(`\nplacar_1= ${document.getElementById('placar1').textContent}`);
        dados.push(`jogador_1= ${document.getElementById('jogador1').value}`);
        dados.push(`pais_1= ${document.getElementById('pais1').value}`);
        dados.push(`avatar_1= ${document.getElementById('avatar1').value}`);
        dados.push(`gods_1= ${coletarDraft(1, 'god').join(',') || 'null'}`);
        dados.push(`maps_1= ${coletarDraft(1, 'map').join(',') || 'null'}`);

        dados.push(`\nplacar_2= ${document.getElementById('placar2').textContent}`);
        dados.push(`jogador_2= ${document.getElementById('jogador2').value}`);
        dados.push(`pais_2= ${document.getElementById('pais2').value}`);
        dados.push(`avatar_2= ${document.getElementById('avatar2').value}`);
        dados.push(`gods_2= ${coletarDraft(2, 'god').join(',') || 'null'}`);
        dados.push(`maps_2= ${coletarDraft(2, 'map').join(',') || 'null'}`);

        dados.push(`\ncor1= ${document.getElementById('cor1').value}`);
        dados.push(`cor2= ${document.getElementById('cor2').value}`);

        dados.push('\nparticulas= sim');

        dados.push(`\ninterface= 1`);

        // Recupera partidas anteriores do localStorage
        const salvosAntigos = localStorage.getItem("dadosInterface");
        const linhasAntigas = salvosAntigos ? JSON.parse(salvosAntigos) : [];
        const partidasExistentes = linhasAntigas.filter(l => l.trim().startsWith("partida"));

        // Adiciona as partidas existentes ao novo conjunto de dados
        dados.push(...partidasExistentes);

        // Atualiza localStorage e arquivo
        localStorage.setItem("dadosInterface", JSON.stringify(dados));

        exibirPartidas(dados);

        const blob = new Blob([dados.join("\n")], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "dados.txt";
        link.click();
      })
    }

    function dispararInput() {
      // Pega o elemento input real
      document.getElementById('arquivoDados').click();
    }

    function processarArquivo(event) {
      const input = event.target;
      const arquivo = input.files[0];

      if (!arquivo) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const conteudo = e.target.result;
        const dados = [];
        const linhas = conteudo.split('\n');
        const mapaCarregado = {};

        linhas.forEach(linha => {
          const partes = linha.split('=');
          if (partes.length >= 2) {
            const chave = partes[0].trim();
            const valor = partes[1].trim();
            dados.push(`${chave}=${valor}`);
            mapaCarregado[chave] = valor;
          }
        });

        localStorage.setItem("dadosInterface", JSON.stringify(dados));

        // Atualiza os campos de texto comuns
        atualizarTodosCampos(JSON.stringify(dados));

        // ATUALIZAÇÃO LOGO... (mantém seu código original)
        if (mapaCarregado.logo_camp) {
          const btn = document.getElementById("btnLogoCamp");
          if (btn) btn.innerText = "Logo: " + mapaCarregado.logo_camp;
          document.getElementById("previewContainer").style.display = "none";
        }

        // --- INÍCIO DA LIMPEZA (Adicione estas linhas abaixo) ---
        // Isso limpa o HTML dos grids de deuses e mapas antes de recarregar
        document.querySelectorAll('.god-grid, .map-grid').forEach(grid => {
            grid.innerHTML = ''; 
        });
        // --- FIM DA LIMPEZA ---

        // ATUALIZAÇÃO MAPAS: Recarrega as grades visuais
        if (typeof atualizarGridMapas === "function") {
          atualizarGridMapas(1);
          atualizarGridMapas(2);
        } else {
          carregarItens('map', 1);
          carregarItens('map', 2);
        }

        carregarItens('god', 1);
        carregarItens('god', 2);

        atualizarNomesDosBotoes();
        atualizarLetreiroComNomes();

        customAlert("Dados carregados com sucesso!", 'Sucesso');
        input.value = '';
      };

      reader.readAsText(arquivo);
    }

    function limparDados() {
      confirmAlert("Limpar Dados", "Tem certeza que deseja resetar <b>TODOS</b> os dados e placar?", () => {
        const salvos = localStorage.getItem("dadosInterface");
        let linhas = salvos ? JSON.parse(salvos) : [];

        // Preserva apenas logo_camp
        const preservados = {};
        linhas.forEach(linha => {
          const [chave, valor] = linha.split('=');
          if (chave && valor !== undefined) {
            if (chave.trim() === 'logo_camp') {
              preservados[chave.trim()] = valor.trim();
            }
          }
        });

        // Limpa localStorage
        localStorage.removeItem("dadosInterface");

        // Grava os campos preservados de volta
        const novasLinhas = [];
        if (preservados.logo_camp) novasLinhas.push(`logo_camp= ${preservados.logo_camp}`);
        localStorage.setItem("dadosInterface", JSON.stringify(novasLinhas));

        // Limpa os campos visualmente (exceto logo_camp, que foi preservado)
        document.getElementById("mapaSelect").value = "null";
        document.getElementById("versusSelect1").value = "null";
        document.getElementById("versusSelect2").value = "null";
        document.getElementById("placar1").textContent = "0";
        document.getElementById("placar2").textContent = "0";
        document.getElementById("jogador1").value = "";
        document.getElementById("jogador2").value = "";
        document.getElementById("avatar1").value = ""; // Limpa Avatar 1
        document.getElementById("avatar2").value = ""; // Limpa Avatar 2
        document.getElementById("pais1").value = "null";
        document.getElementById("pais2").value = "null";
        document.getElementById("bandeira1").src = "";
        document.getElementById("bandeira1").alt = "";
        document.getElementById("bandeira2").src = "";
        document.getElementById("bandeira2").alt = "";
        document.getElementById("letreiro").value = "1";
        document.getElementById("cor1").value = "azul";
        document.getElementById("cor2").value = "vermelho";
        trocarCorDeFundo();
        exibirPartidas();

        // Limpa os drafts
        limparMarcacoes(1);
        limparMarcacoes(2);

        location.reload();

      });
    }

    function restaurarDraft(jogador, tipo, dados) {
      const container = document.querySelector(`.${tipo}-grid[data-jogador="${jogador}"]`);
      const linhaKey = tipo === 'god' ? `gods_${jogador}` : `maps_${jogador}`;
      const lista = (dados[linhaKey] || '').split(',').filter(x => x);

      if (!container) return;

      const imgs = container.querySelectorAll('.item-img');
      imgs.forEach(img => {
        const nome = img.dataset.nome;
        const pick = lista.includes(`${nome}_p`);
        const ban = lista.includes(`${nome}_b`);
        if (pick) {
          img.src = `AoM/assets/${tipo === 'god' ? 'gods' : 'mapas'}/${nome}_p.png`;
          img.dataset.estado = 'pick';
        } else if (ban) {
          img.src = `AoM/assets/${tipo === 'god' ? 'gods' : 'mapas'}/${nome}_b.png`;
          img.dataset.estado = 'ban';
        } else {
          img.src = `AoM/assets/${tipo === 'god' ? 'gods' : 'mapas'}/${nome}.png`;
          img.dataset.estado = '';
        }
      });
    }

    async function importarDraftGods() {
      const link = document.getElementById("draftLink").value.trim();
      if (!link) {
        customAlert("Cole o link do draft do aoe2cm.net antes de importar.", "Error");
        return;
      }

      const match = link.match(/draft\/([A-Za-z0-9_-]+)/);
      if (!match) {
        customAlert("Link inválido. O formato deve ser como: https://aoe2cm.net/draft/xxxxx", "Error");
        return;
      }

      const draftId = match[1];
      const apiUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://aoe2cm.net/api/draft/${draftId}`)}`;

      let loadingModal;

      try {
        // LOADING
        loadingModal = document.createElement('div');
        loadingModal.style.cssText = `
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); display: flex; justify-content: center;
      align-items: center; z-index: 1000; color: white; font-size: 1.2em;
    `;
        loadingModal.innerHTML = `<div style="display: flex; flex-direction: column; align-items: center; padding: 20px;">
          <p>Carregando Draft de Gods...</p>
          <div class="spinner"></div>
          </div>`;
        document.body.appendChild(loadingModal);

        // Retry com backoff
        let response, draft;
        const maxRetries = 3;
        for (let i = 0; i < maxRetries; i++) {
          try {
            response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`Status: ${response.status}`);
            draft = await response.json();
            break;
          } catch (e) {
            if (i === maxRetries - 1) throw e;
            await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
          }
        }

        document.body.removeChild(loadingModal);

        // ---- Nomes da API
        const nomeHostAPI = draft.nameHost || "Jogador HOST (API)";
        const nomeGuestAPI = draft.nameGuest || "Jogador GUEST (API)";

        // Inputs atuais
        const inputJogador1 = document.getElementById("jogador1");
        const inputJogador2 = document.getElementById("jogador2");

        const v1 = inputJogador1.value.trim();
        const v2 = inputJogador2.value.trim();

        // Normalizador (Gods têm prefixo "aomgods.")
        const normalizarNome = (str) =>
          str ? String(str)
            .replace(/^aomgods\./i, "")
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
            .replace(/\s+/g, "")
            .toLowerCase() : "";

        const normV1 = normalizarNome(v1);
        const normV2 = normalizarNome(v2);
        const normHostAPI = normalizarNome(nomeHostAPI);
        const normGuestAPI = normalizarNome(nomeGuestAPI);

        // -------------------------------
        // 1) SE OS DOIS INPUTS ESTÃO VAZIOS → preencher automaticamente
        // -------------------------------
        if (!v1 && !v2) {
          inputJogador1.value = nomeHostAPI;
          inputJogador2.value = nomeGuestAPI;
          aplicarImportacaoCompleta();
          return;
        }

        // -------------------------------
        // 2) VERIFICAÇÃO DE DIFERENÇA OU INVERSÃO
        // -------------------------------
        let nomesSaoIguais =
          normV1 === normHostAPI && normV2 === normGuestAPI;

        let nomesEstaoInvertidos =
          normV1 === normGuestAPI && normV2 === normHostAPI;

        let nomesCompletamenteDiferentes =
          !nomesSaoIguais && !nomesEstaoInvertidos;

        // Se iguais → aplicar direto
        if (nomesSaoIguais) {
          aplicarImportacaoCompleta();
          return;
        }

        // Se invertidos ou diferentes → pedir confirmação
        if (nomesEstaoInvertidos || nomesCompletamenteDiferentes) {
          confirmAlert("Alerta!",
            "Os nomes estão diferentes da ordem do draft.\nDeseja substituir os nomes e aplicar o draft?",
            () => {
              inputJogador1.value = nomeHostAPI;
              inputJogador2.value = nomeGuestAPI;
              aplicarImportacaoCompleta();
            }
          );

          return; // Esperar usuário confirmar
        }

        // ---------------------------------------------------------
        // Função que realmente processa picks/bans e aplica no DOM
        // ---------------------------------------------------------
        function aplicarImportacaoCompleta() {
          // Mapeia HOST/GUEST para jogadores
          let hostPlayer = 1, guestPlayer = 2;

          const n1 = normalizarNome(inputJogador1.value);
          const n2 = normalizarNome(inputJogador2.value);

          if (n1 === normHostAPI) { hostPlayer = 1; guestPlayer = 2; }
          else if (n2 === normHostAPI) { hostPlayer = 2; guestPlayer = 1; }
          else if (n1 === normGuestAPI) { guestPlayer = 1; hostPlayer = 2; }
          else if (n2 === normGuestAPI) { guestPlayer = 2; hostPlayer = 1; }

          const events = draft.events || [];
          const picks = { 1: [], 2: [] };
          const bans = { 1: [], 2: [] };

          events.forEach(ev => {
            const p = ev.player;
            const t = (ev.actionType || "").toLowerCase();
            const chosen = normalizarNome(ev.chosenOptionId);
            if (!chosen || p === "NONE") return;

            let target = p === "HOST" ? hostPlayer : guestPlayer;

            if (t === "pick") picks[target].push(`${chosen}_p`);
            if (t === "ban") bans[target].push(`${chosen}_b`);
          });

          // --- Aplicar GODS no HUD
          function aplicarGods(jogador, picksJog, bansJog) {
            const container = document.querySelector(`.god-grid[data-jogador="${jogador}"]`);
            if (!container) return;

            const imgs = container.querySelectorAll('.item-img');

            imgs.forEach(img => {
              const nomeImg = normalizarNome(img.dataset.nome || "");
              img.dataset.estado = '';
              img.src = `AoM/assets/gods/${nomeImg}.png`;

              if (picksJog.includes(`${nomeImg}_p`)) {
                img.src = `AoM/assets/gods/${nomeImg}_p.png`;
                img.dataset.estado = 'pick';
              } else if (bansJog.includes(`${nomeImg}_b`)) {
                img.src = `AoM/assets/gods/${nomeImg}_b.png`;
                img.dataset.estado = 'ban';
              }
            });
          }

          aplicarGods(1, picks[1], bans[1]);
          aplicarGods(2, picks[2], bans[2]);

          atualizarNomesDosBotoes();
          atualizarLetreiroComNomes();

          customAlert(`✅ Draft de GODS importado com sucesso!\n${nomeHostAPI} (HOST) vs ${nomeGuestAPI} (GUEST)`);
        }

      } catch (err) {
        console.error("Erro ao importar GODS:", err);
        try { document.body.removeChild(loadingModal); } catch { }
        customAlert("Falha ao importar o draft. Verifique o link e tente novamente.", 'Error');
      }
    }


    async function importarDraftMapas() {
      const link = document.getElementById("draftLinkMapas").value.trim();
      if (!link) {
        customAlert("Cole o link do draft de MAPAS do aoe2cm.net antes de importar.", 'Error');
        return;
      }

      const match = link.match(/draft\/([A-Za-z0-9_-]+)/);
      if (!match) {
        customAlert("Link inválido. O formato deve ser como: https://aoe2cm.net/draft/xxxxx", 'Error');
        return;
      }

      const draftId = match[1];
      const apiUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://aoe2cm.net/api/draft/${draftId}`)}`;

      try {
        // LOADING
        const loadingModal = document.createElement('div');
        loadingModal.style.cssText = `
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); display: flex; justify-content: center;
      align-items: center; z-index: 1000; color: white; font-size: 1.2em;
    `;
        loadingModal.innerHTML = `<div style="display: flex; flex-direction: column; align-items: center; padding: 20px;">
          <p>Carregando Draft de Mapas...</p>
          <div class="spinner"></div>
          </div>`;
        document.body.appendChild(loadingModal);

        // Retry com backoff
        let response, draft;
        const maxRetries = 3;
        for (let i = 0; i < maxRetries; i++) {
          try {
            response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`Status: ${response.status}`);
            draft = await response.json();
            break;
          } catch (e) {
            if (i === maxRetries - 1) throw e;
            await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
          }
        }

        document.body.removeChild(loadingModal);

        console.log("Draft de Mapas importado:", draft);

        // ---- Nomes da API
        const nomeHostAPI = draft.nameHost || "Jogador HOST (API)";
        const nomeGuestAPI = draft.nameGuest || "Jogador GUEST (API)";

        // Inputs atuais
        const inputJogador1 = document.getElementById("jogador1");
        const inputJogador2 = document.getElementById("jogador2");

        const v1 = inputJogador1.value.trim();
        const v2 = inputJogador2.value.trim();

        // Normalizador
        const normalizarNome = (str) =>
          str ? String(str)
            .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
            .replace(/[^a-zA-Z0-9]/g, "")
            .toLowerCase()
            : "";

        const normV1 = normalizarNome(v1);
        const normV2 = normalizarNome(v2);
        const normHostAPI = normalizarNome(nomeHostAPI);
        const normGuestAPI = normalizarNome(nomeGuestAPI);

        // -------------------------------
        // 1) SE OS DOIS INPUTS ESTÃO VAZIOS → preencher automaticamente
        // -------------------------------
        if (!v1 && !v2) {
          inputJogador1.value = nomeHostAPI;
          inputJogador2.value = nomeGuestAPI;
          aplicarImportacaoCompleta();
          return;
        }

        // -------------------------------
        // 2) VERIFICAÇÃO DE DIFERENÇA OU DE INVERSÃO
        // -------------------------------
        let nomesSaoIguais =
          normV1 === normHostAPI && normV2 === normGuestAPI;

        let nomesEstaoInvertidos =
          normV1 === normGuestAPI && normV2 === normHostAPI;

        let nomesCompletamenteDiferentes =
          !nomesSaoIguais && !nomesEstaoInvertidos;

        // Se os nomes são IGUAIS → aplicar mapas direto
        if (nomesSaoIguais) {
          aplicarImportacaoCompleta();
          return;
        }

        // Se nomes são invertidos OU diferentes → perguntar ao usuário
        if (nomesEstaoInvertidos || nomesCompletamenteDiferentes) {
          confirmAlert("Alerta!",
            "Os nomes estão diferentes da ordem do draft.\nDeseja substituir os nomes e aplicar o draft?",
            () => {
              // Usuário confirmou → sobrescrever os nomes conforme a API
              inputJogador1.value = nomeHostAPI;
              inputJogador2.value = nomeGuestAPI;
              aplicarImportacaoCompleta();
            }
          );

          return; // Não continua até o usuário responder
        }

        // ---------------------------------------------------------
        // Função que realmente processa picks/bans e aplica no DOM
        // ---------------------------------------------------------
        function aplicarImportacaoCompleta() {
          // Mapeia HOST/GUEST para jogadores
          let hostPlayer = 1, guestPlayer = 2;

          const n1 = normalizarNome(inputJogador1.value);
          const n2 = normalizarNome(inputJogador2.value);

          if (n1 === normHostAPI) { hostPlayer = 1; guestPlayer = 2; }
          else if (n2 === normHostAPI) { hostPlayer = 2; guestPlayer = 1; }
          else if (n1 === normGuestAPI) { guestPlayer = 1; hostPlayer = 2; }
          else if (n2 === normGuestAPI) { guestPlayer = 2; hostPlayer = 1; }

          const events = draft.events || [];
          const picksPorJogador = { 1: [], 2: [] };
          const bansPorJogador = { 1: [], 2: [] };

          events.forEach(ev => {
            const p = ev.player;
            const t = (ev.actionType || "").toLowerCase();
            const chosen = ev.chosenOptionId;

            if (!chosen) return;
            const mapa = normalizarNome(chosen);

            if (p === "NONE" && t === "pick") {
              const mapaSelect = document.getElementById("mapaSelect");
              if (mapaSelect) mapaSelect.value = chosen;
            }

            let target = p === "HOST" ? hostPlayer : guestPlayer;

            if (t === "pick") picksPorJogador[target].push(`${mapa}_p`);
            if (t === "ban") bansPorJogador[target].push(`${mapa}_b`);
          });

          function aplicarMapas(jogador, picks, bans) {
            const container = document.querySelector(`.map-grid[data-jogador="${jogador}"]`);
            if (!container) return;
            const imgs = container.querySelectorAll('.item-img');

            imgs.forEach(img => {
              const nomeImg = normalizarNome(img.dataset.nome || "");
              img.dataset.estado = '';
              img.src = `AoM/assets/mapas/${nomeImg}.png`;

              if (picks.includes(`${nomeImg}_p`)) {
                img.src = `AoM/assets/mapas/${nomeImg}_p.png`;
                img.dataset.estado = 'pick';
              } else if (bans.includes(`${nomeImg}_b`)) {
                img.src = `AoM/assets/mapas/${nomeImg}_b.png`;
                img.dataset.estado = 'ban';
              }
            });
          }

          aplicarMapas(1, picksPorJogador[1], bansPorJogador[1]);
          aplicarMapas(2, picksPorJogador[2], bansPorJogador[2]);

          atualizarNomesDosBotoes();
          atualizarLetreiroComNomes();

          customAlert(`✅ Draft de mapas importado com sucesso!\n${nomeHostAPI} (HOST) vs ${nomeGuestAPI} (GUEST)`);
        }

      } catch (err) {
        console.error("Erro na importação do draft:", err);
        try { document.body.removeChild(loadingModal); } catch { }
        customAlert("Falha ao importar o draft de mapas. Verifique o link e tente novamente.", 'Error');
      }
    }

    // NOVO: Mapa de cores escuras para o background
    const colorMap = {
      'azul': '#1d1d4a', // Dark Blue/Indigo (Original Player 1)
      'vermelho': '#541b1b', // Dark Red/Maroon (Original Player 2)
      'amarelo': '#a2a232', // Dark Yellow/Gold
      'verde': '#275d26', // Dark Green
      'ciano': '#2996a0', // Dark Cyan/Teal
      'rosa': '#6b016b', // Dark Pink/Violet
      'laranja': '#a05c0e', // Dark Orange
      'vinho': '#590e28', // Dark Wine
      'turquesa': '#026d48', // Dark Turquoise
      'salmao': '#985c49', // Dark Salmon
      'roxo': '#3f076d', // Dark Purple
      'cinza': '#222222' // Dark Gray
    };

    // NOVA FUNÇÃO: Troca a cor de fundo dos elementos dos jogadores
    function trocarCorDeFundo() {
      const cor1 = document.getElementById('cor1').value;
      const cor2 = document.getElementById('cor2').value;

      const player1El = document.querySelector('.player1');
      const player2El = document.querySelector('.player2');
      const vs1El = document.querySelector('.versusSelect1');
      const vs2El = document.querySelector('.versusSelect2');

      // NOVO: Seleciona os botões de vitória
      const btnVitoria1El = document.querySelector('.jogadorv1');
      const btnVitoria2El = document.querySelector('.jogadorv2');

      if (player1El && colorMap[cor1]) {
        player1El.style.backgroundColor = colorMap[cor1];
      }
      if (player2El && colorMap[cor2]) {
        player2El.style.backgroundColor = colorMap[cor2];
      }

      // Atualiza também as labels de God 1 e God 2
      if (vs1El && colorMap[cor1]) {
        vs1El.style.backgroundColor = colorMap[cor1];
      }
      if (vs2El && colorMap[cor2]) {
        vs2El.style.backgroundColor = colorMap[cor2];
      }

      // NOVO: Atualiza os botões de vitória
      if (btnVitoria1El && colorMap[cor1]) {
        btnVitoria1El.style.backgroundColor = colorMap[cor1];
      }
      if (btnVitoria2El && colorMap[cor2]) {
        btnVitoria2El.style.backgroundColor = colorMap[cor2];
      }

      const partidasEsquerda = document.querySelectorAll('.partida.esquerda');
      const partidasDireita = document.querySelectorAll('.partida.direita');

      if (partidasEsquerda && colorMap[cor1]) {
        const background1 = `linear-gradient(to right, ${colorMap[cor1]} 1%, transparent 100%)`;
        partidasEsquerda.forEach(partida => {
          partida.style.background = background1;
        });
      }
      // ...
      if (partidasDireita && colorMap[cor2]) {
        const background2 = `linear-gradient(to left, ${colorMap[cor2]} 1%, transparent 100%)`;
        partidasDireita.forEach(partida => {
          partida.style.background = background2;
        });
      }

    }

    function captainsLink() {
      window.open('https://aoe2cm.net/spectate', '_blank');
    }

    function aomStatsLinkByPlayer(playerId) {
      const player = document.getElementById(playerId);
      const playerName = player.value;

      if (!playerName) {
        player.style.border = '2px solid red';
        customAlert("Para pesquisar no AoM Stats precisa do nome do jogador.", 'Error');
        return;

      };
      window.open(`https://aomstats.io/profiles?s=${playerName}`, '_blank');
    }

  </script>


</body>

</html>